# ============================================================================
# HYPRLAND CONFIG - Randy's Dark Purple Setup
# ============================================================================

# ============================================================================
# NVIDIA SETTINGS (RTX 3090)
# ============================================================================
env = LIBVA_DRIVER_NAME,nvidia
env = XDG_SESSION_TYPE,wayland
env = GBM_BACKEND,nvidia-drm
env = __GLX_VENDOR_LIBRARY_NAME,nvidia
env = NVD_BACKEND,direct

# Cursor settings for NVIDIA
env = WLR_NO_HARDWARE_CURSORS,1
env = XCURSOR_SIZE,32
env = XCURSOR_THEME,Skyrim-by-ru5tyshark-cursors

# Qt/GTK theming - Dark Purple theme
env = QT_QPA_PLATFORMTHEME,qt5ct
env = QT_STYLE_OVERRIDE,kvantum
env = GTK_THEME,Breeze-Dark
env = QT_AUTO_SCREEN_SCALE_FACTOR,1
env = QT_WAYLAND_DISABLE_WINDOWDECORATION,1

# ============================================================================
# MONITORS
# Layout: [DP-1 1440p] [DP-3 1440p PRIMARY] [HDMI-A-1 1080p]
# ============================================================================
monitor = DP-3, 2560x1440@165, 0x0, 1          # Center (primary) - ASUS
monitor = DP-1, 2560x1440@144, -2560x0, 1      # Left - LG ULTRAGEAR
monitor = HDMI-A-1, 1920x1080@60, 2560x180, 1  # Right (offset to align) - HP

# ============================================================================
# STARTUP
# ============================================================================
# Polkit agent for authentication dialogs (needed for WiFi, etc.)
exec-once = /usr/libexec/polkit-kde-authentication-agent-1

# Video wallpaper on all monitors (loop forever, no audio)
exec-once = mpvpaper -o "no-audio loop" '*' ~/Pictures/Wallpapers/Cozy_Rain_30s.webm

# AGS - bar, notifications, widgets
exec-once = GI_TYPELIB_PATH=/usr/local/lib64/girepository-1.0 ags run

# Hypridle - idle management (screen off, lock, suspend)
exec-once = hypridle

# Clipboard history - store clipboard to cliphist
exec-once = wl-paste --type text --watch cliphist store
exec-once = wl-paste --type image --watch cliphist store

# ============================================================================
# INPUT
# ============================================================================
input {
    kb_layout = us
    follow_mouse = 2  # 0=disabled, 1=always, 2=click to focus (keeps cursor warp)
    sensitivity = 0

    touchpad {
        natural_scroll = false
    }
}

# ============================================================================
# GENERAL - Dark Purple Theme
# ============================================================================
general {
    gaps_in = 4
    gaps_out = 8
    border_size = 0

    # No border - using glow shadow instead
    col.active_border = rgba(00000000)
    col.inactive_border = rgba(00000000)

    layout = dwindle
    allow_tearing = false
}

# ============================================================================
# DECORATION
# ============================================================================
decoration {
    rounding = 12

    blur {
        enabled = true
        size = 10
        passes = 3
        new_optimizations = true
        xray = false
    }

    # Purple glow for active window, subtle shadow for inactive
    shadow {
        enabled = true
        range = 25
        render_power = 2
        color = rgba(157, 78, 221, 0.5)
        color_inactive = rgba(0, 0, 0, 0.4)
        offset = 0, 0
    }
}

# ============================================================================
# RENDER - NVIDIA explicit sync to prevent driver crashes
# ============================================================================
render {
    explicit_sync = 2
}

# ============================================================================
# LAYER RULES - AGS Windows
# ============================================================================
layerrule = blur, ags-.*
layerrule = ignorezero, ags-.*
layerrule = noanim, ags-launcher

# ============================================================================
# ANIMATIONS - macOS-like smooth and snappy
# ============================================================================
animations {
    enabled = true

    # macOS-inspired bezier curves
    bezier = macOS, 0.4, 0.0, 0.2, 1.0           # Smooth easing
    bezier = macOSOut, 0.0, 0.0, 0.2, 1.0        # Quick start, smooth end
    bezier = macOSIn, 0.4, 0.0, 1.0, 1.0         # Smooth start, quick end
    bezier = popup, 0.32, 0.0, 0.67, 0.0         # Snappy popups

    # Snappier, faster animations
    animation = windows, 1, 3, macOS, slide
    animation = windowsOut, 1, 2.5, macOSOut, slide
    animation = windowsMove, 1, 2.5, macOS
    animation = border, 1, 8, default
    animation = borderangle, 1, 100, default, loop
    animation = fade, 1, 2.5, macOS
    animation = fadeIn, 1, 2, macOSIn
    animation = fadeOut, 1, 2, macOSOut
    animation = workspaces, 1, 3.5, macOS, slidevert

    # Clean fade for popups/layers (no goofy slide)
    animation = layers, 1, 1.5, macOS, fade
    animation = layersIn, 1, 1.5, macOS, fade
    animation = layersOut, 1, 1, macOSOut, fade
}

# ============================================================================
# LAYOUTS
# ============================================================================
dwindle {
    pseudotile = true
    preserve_split = true
    force_split = 2
    smart_split = false
}

master {
    new_status = master
}

# ============================================================================
# MISC
# ============================================================================
misc {
    force_default_wallpaper = 0
    disable_hyprland_logo = true
    disable_splash_rendering = true
    vfr = true
}

# ============================================================================
# DEBUG - Suppress error popups (use Super+Backspace to dismiss if any appear)
# ============================================================================
debug {
    suppress_errors = true
}

# ============================================================================
# KEYBINDS
# ============================================================================
$mainMod = SUPER

# Core
bind = $mainMod, Return, exec, ghostty
bind = $mainMod, D, exec, ags toggle launcher
bind = ALT, SPACE, exec, ags toggle launcher
bind = $mainMod, Q, killactive,
bind = $mainMod SHIFT, E, exit,
bind = $mainMod, Backspace, exec, hyprctl seterror disable  # Dismiss error popups
bind = $mainMod, V, togglefloating,
bind = $mainMod, F, fullscreen, 1
bind = $mainMod SHIFT, F, fullscreen, 0
bind = $mainMod, P, pseudo,
bind = $mainMod, S, togglesplit,

# Screenshots
bind = , Print, exec, hyprshot -m output
bind = SHIFT, Print, exec, hyprshot -m region
bind = $mainMod, Print, exec, hyprshot -m window

# Lock screen
bind = $mainMod, Escape, exec, hyprlock

# Focus movement
bind = $mainMod, left, movefocus, l
bind = $mainMod, right, movefocus, r
bind = $mainMod, up, movefocus, u
bind = $mainMod, down, movefocus, d

# Vim-style focus
bind = $mainMod, H, movefocus, l
bind = $mainMod, J, movefocus, d
bind = $mainMod, K, movefocus, u
bind = $mainMod, L, movefocus, r

# Move windows
bind = $mainMod SHIFT, left, movewindow, l
bind = $mainMod SHIFT, right, movewindow, r
bind = $mainMod SHIFT, up, movewindow, u
bind = $mainMod SHIFT, down, movewindow, d

bind = $mainMod SHIFT, H, movewindow, l
bind = $mainMod SHIFT, J, movewindow, d
bind = $mainMod SHIFT, K, movewindow, u
bind = $mainMod SHIFT, L, movewindow, r

# Resize windows
bind = $mainMod CTRL, left, resizeactive, -40 0
bind = $mainMod CTRL, right, resizeactive, 40 0
bind = $mainMod CTRL, up, resizeactive, 0 -40
bind = $mainMod CTRL, down, resizeactive, 0 40

# App shortcuts (Super+1-9) - raise or run or cycle
$raiseOrRun = ~/.config/hypr/scripts/raise-or-run.sh
bind = $mainMod, 1, exec, $raiseOrRun ghostty ghostty
bind = $mainMod, 2, exec, $raiseOrRun google-chrome google-chrome-stable
bind = $mainMod, 3, exec, $raiseOrRun firefox firefox
bind = $mainMod, 4, exec, $raiseOrRun Code code
bind = $mainMod, 5, exec, $raiseOrRun discord discord
bind = $mainMod, 6, exec, $raiseOrRun spotify spotify
bind = $mainMod, 7, exec, $raiseOrRun obsidian obsidian
bind = $mainMod, 8, exec, $raiseOrRun slack slack
bind = $mainMod, 9, exec, $raiseOrRun steam steam
# Super+0 still available for another app

# Workspaces (Ctrl+Super+1-9)
bind = $mainMod CTRL, 1, workspace, 1
bind = $mainMod CTRL, 2, workspace, 2
bind = $mainMod CTRL, 3, workspace, 3
bind = $mainMod CTRL, 4, workspace, 4
bind = $mainMod CTRL, 5, workspace, 5
bind = $mainMod CTRL, 6, workspace, 6
bind = $mainMod CTRL, 7, workspace, 7
bind = $mainMod CTRL, 8, workspace, 8
bind = $mainMod CTRL, 9, workspace, 9
bind = $mainMod CTRL, 0, workspace, 10

# Move window to workspace (Ctrl+Super+Shift+1-9)
bind = $mainMod CTRL SHIFT, 1, movetoworkspace, 1
bind = $mainMod CTRL SHIFT, 2, movetoworkspace, 2
bind = $mainMod CTRL SHIFT, 3, movetoworkspace, 3
bind = $mainMod CTRL SHIFT, 4, movetoworkspace, 4
bind = $mainMod CTRL SHIFT, 5, movetoworkspace, 5
bind = $mainMod CTRL SHIFT, 6, movetoworkspace, 6
bind = $mainMod CTRL SHIFT, 7, movetoworkspace, 7
bind = $mainMod CTRL SHIFT, 8, movetoworkspace, 8
bind = $mainMod CTRL SHIFT, 9, movetoworkspace, 9
bind = $mainMod CTRL SHIFT, 0, movetoworkspace, 10

# Mouse binds
bindm = $mainMod, mouse:272, movewindow
bindm = $mainMod, mouse:273, resizewindow

# Scroll through workspaces
bind = $mainMod, mouse_down, workspace, e+1
bind = $mainMod, mouse_up, workspace, e-1

# Focus adjacent monitor (Super+Ctrl+H/L)
bind = $mainMod CTRL, H, focusmonitor, l
bind = $mainMod CTRL, L, focusmonitor, r

# Move window to adjacent monitor (Super+Ctrl+Shift+H/L)
bind = $mainMod CTRL SHIFT, H, movewindow, mon:l
bind = $mainMod CTRL SHIFT, L, movewindow, mon:r

# ============================================================================
# WINDOW RULES
# ============================================================================
# Opacity - inactive windows slightly transparent
windowrulev2 = opacity 0.95, focus:0
windowrulev2 = opacity 1.0, focus:1

# Floating windows - dialogs and utilities
windowrulev2 = float, class:^(pavucontrol)$
windowrulev2 = float, class:^(blueman-manager)$
windowrulev2 = float, class:^(nm-connection-editor)$
windowrulev2 = float, class:^(file-roller)$
windowrulev2 = float, class:^(org.kde.polkit-kde-authentication-agent-1)$
windowrulev2 = float, class:^(xdg-desktop-portal-gtk)$
windowrulev2 = float, class:^(org.kde.dolphin)$, title:^(Progress Dialog.*)$
windowrulev2 = float, class:^(org.kde.dolphin)$, title:^(Copying.*)$
windowrulev2 = float, title:^(Open File)$
windowrulev2 = float, title:^(Save File)$
windowrulev2 = float, title:^(Open Folder)$
windowrulev2 = float, title:^(Confirm to replace files)$
windowrulev2 = float, title:^(File Operation Progress)$
windowrulev2 = float, title:^(Picture-in-Picture)$
windowrulev2 = pin, title:^(Picture-in-Picture)$

# Center floating windows
windowrulev2 = center, floating:1

# App workspace assignments
windowrulev2 = workspace 1, class:^(google-chrome)$
windowrulev2 = workspace 2, class:^(com.mitchellh.ghostty)$

# ============================================================================
# WORKSPACE RULES - Bind workspaces to monitors
# Primary layout: 1=center, 2=left, 3=right
# ============================================================================
workspace = 1, monitor:DP-3, default:true
workspace = 2, monitor:DP-1, default:true
workspace = 3, monitor:HDMI-A-1, default:true
# Additional workspaces
workspace = 4, monitor:DP-3
workspace = 5, monitor:DP-1
workspace = 6, monitor:HDMI-A-1
workspace = 7, monitor:DP-3
workspace = 8, monitor:DP-1
workspace = 9, monitor:HDMI-A-1
workspace = 10, monitor:DP-3

# Smart gaps: no gaps/shadow when only one tiled window
# w[tv1] = workspace with 1 tiled visible window
workspace = w[tv1], gapsout:0, gapsin:0
windowrulev2 = bordersize 0, floating:0, onworkspace:w[tv1]
windowrulev2 = noshadow, floating:0, onworkspace:w[tv1]

layerrule = blur, rofi
layerrule = ignorezero, rofi
